version: "3.2"
services:
  test:
    build:
      context: ../../
      dockerfile: docker/test/Dockerfile
    environment:
      - JUNIT_REPORT_PATH=/reports/unitandintegration.xml
      - PORT=3000
      - NODE_ENV=test
    expose:
      - 3000
    volumes:
    - rtconntest:/app
    networks:
      - rtconn
    depends_on:
      - mongo
      - redis

  node:
      build:
        context: ../../
        dockerfile: docker/test/Dockerfile
      environment:
        - PORT=3000
        - NODE_ENV=development
      expose:
        - 3000
      ports:
        - 3000:3000
      volumes:
      - ../../src:/app
      networks:
        - rtconn
      depends_on:
        - mongo
        - redis
      command: ["npm", "run", "watch"]
  mongo:
    image: mongo:latest
    networks:
      - rtconn
  redis:
    image: redis:latest
    volumes:
      - ../../src/data/redis:/data
    networks:
      - rtconn

volumes:
  rtconntest:
    external: true
networks:
  rtconn:

